<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&family=Tajawal:wght@400;500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <i class="fas fa-chart-line"></i>
                    <span>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯</span>
                </div>
                <ul class="navbar-nav">
                    <li><a href="../index.html" class="nav-link">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
                    <li><a href="forecast.html" class="nav-link">Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</a></li>
                    <li><a href="alerts.html" class="nav-link">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a></li>
                    <li><a href="production.html" class="nav-link">Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…Ø­Ù„ÙŠ</a></li>
                    <li><a href="competitive.html" class="nav-link">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©</a></li>
                    <li><a href="strategy.html" class="nav-link active">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="hero" style="padding: 2rem 0;">
        <div class="container">
            <h1 class="fade-in">ğŸ¯ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ</h1>
            <p class="hero-subtitle">
                Ø±Ø¤Ù‰ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù‚Ø±Ø§Ø± Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            </p>
        </div>
    </section>

    <section class="container">
        <div class="card slide-up">
            <div class="flex-between" style="margin-bottom: 2rem;">
                <h2 style="margin: 0;">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©</h2>
                <button class="btn btn-primary" onclick="generateSummary()">
                    <i class="fas fa-magic"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ
                </button>
            </div>

            <div id="decisionCard" class="card-glass" style="padding: 2rem; margin-bottom: 2rem; display: none;">
                <div class="flex-between" style="margin-bottom: 1.5rem;">
                    <div>
                        <h3 id="commodityName">Ø§Ù„Ù‚Ù…Ø­</h3>
                        <p style="color: var(--text-muted); margin: 0;">Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ</p>
                    </div>
                    <div style="text-align: left;">
                        <div style="font-size: 2rem; font-weight: 700; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"
                            id="recommendation">--</div>
                        <div style="margin-top: 0.5rem;">
                            <span class="badge badge-primary" id="confidenceBadge">
                                <i class="fas fa-chart-simple"></i>
                                Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©: --
                            </span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-3" style="margin-bottom: 1.5rem;">
                    <div
                        style="text-align: center; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-right: 3px solid var(--accent-red); border-radius: var(--radius-md);">
                        <i class="fas fa-globe"
                            style="font-size: 1.5rem; color: var(--accent-red); margin-bottom: 0.5rem;"></i>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-red);" id="globalRisk">--
                        </div>
                        <div style="color: var(--text-muted); font-size: 0.875rem;">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</div>
                    </div>
                    <div
                        style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-right: 3px solid var(--accent-amber); border-radius: var(--radius-md);">
                        <i class="fas fa-map-marker-alt"
                            style="font-size: 1.5rem; color: var(--accent-amber); margin-bottom: 0.5rem;"></i>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-amber);" id="localRisk">--
                        </div>
                        <div style="color: var(--text-muted); font-size: 0.875rem;">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­Ù„ÙŠØ©</div>
                    </div>
                    <div
                        style="text-align: center; padding: 1rem; background: rgba(99, 102, 241, 0.1); border-right: 3px solid var(--primary-500); border-radius: var(--radius-md);">
                        <i class="fas fa-truck"
                            style="font-size: 1.5rem; color: var(--primary-500); margin-bottom: 0.5rem;"></i>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-500);" id="logisticRisk">
                            --</div>
                        <div style="color: var(--text-muted); font-size: 0.875rem;">Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ©</div>
                    </div>
                </div>

                <div class="alert" id="riskAlert" style="margin-bottom: 1.5rem;">
                    <strong>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø± Ø§Ù„Ø³Ø§Ø¦Ø¯:</strong> <span id="dominantRisk">--</span>
                </div>

                <div
                    style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-lightbulb"></i>
                        Ø§Ù„ØªØ­Ù„ÙŠÙ„
                    </h4>
                    <p style="margin: 0; color: var(--text-secondary);" id="explanationText">--</p>
                </div>

                <h4 style="font-size: 1rem; margin-bottom: 1rem;">
                    <i class="fas fa-tasks"></i>
                    Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©
                </h4>
                <div id="actionItems"></div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <div>
                    <h4 style="margin-bottom: 1rem;">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</h4>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>

                <div>
                    <h4 style="margin-bottom: 1rem;">Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù‚Ø±Ø§Ø±</h4>
                    <div id="metricsContainer"></div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2026 ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            </div>
        </div>
    </footer>

    <script src="../assets/js/api.js"></script>
    <script>
        let riskChart = null;

        async function generateSummary() {
            try {
                showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ...');

                const requestData = {
                    commodity_id: 'wheat',
                    api_outputs: {
                        cost_forecast: { avg_predicted_cost: 640.0, trend_direction: 'rising', main_cost_driver: 'Index_Cost_Shipping' },
                        early_warning: { supply_alert_level: 'Medium', expected_increase_pct: 12.5 },
                        local_production: { production_outlook: 'Medium', reliability_score: 0.78 },
                        competitive_health: { margin_pressure_level: 'Moderate', competitive_position: 'Neutral' }
                    },
                    business_context: {
                        current_inventory_days: 25,
                        budget_available: 500000.0,
                        urgency_level: 'medium'
                    }
                };

                const response = await apiClient.getStrategicSummary(requestData);
                hideLoading();
                displaySummary(response.data, response.metadata);
                showAlert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ø¨Ù†Ø¬Ø§Ø­!', 'success');

            } catch (error) {
                hideLoading();
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ø®Øµ:', error);
                showAlert('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø®Øµ. ' + error.message, 'danger');
            }
        }

        function displaySummary(data, metadata) {
            document.getElementById('decisionCard').style.display = 'block';
            document.getElementById('commodityName').textContent = getCommodityName(data.commodity_id);
            document.getElementById('recommendation').textContent = data.recommendation;

            const confidencePercent = (data.confidence_level * 100).toFixed(0);
            document.getElementById('confidenceBadge').innerHTML = `<i class="fas fa-chart-simple"></i> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©: ${confidencePercent}%`;

            document.getElementById('globalRisk').textContent = (data.risk_breakdown.global_risk_score * 100).toFixed(0) + '%';
            document.getElementById('localRisk').textContent = (data.risk_breakdown.local_risk_score * 100).toFixed(0) + '%';
            document.getElementById('logisticRisk').textContent = (data.risk_breakdown.logistic_risk_score * 100).toFixed(0) + '%';

            const riskAlert = document.getElementById('riskAlert');
            riskAlert.className = 'alert alert-' + (data.dominant_risk_type === 'Global' ? 'danger' : 'warning');
            document.getElementById('dominantRisk').textContent = data.dominant_risk_type;
            document.getElementById('explanationText').textContent = data.explanation_text;

            renderActionItems(data.action_items);
            renderRiskChart(data.risk_breakdown);
            renderMetrics(metadata, data);
        }

        function renderActionItems(items) {
            const container = document.getElementById('actionItems');
            container.innerHTML = items.map((item, index) => `
                <div style="display: flex; gap: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 0.75rem; border-right: 3px solid var(--primary-500);">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: 700;">
                        ${item.priority}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">${item.action}</div>
                        <div style="font-size: 0.875rem; color: var(--text-muted);">
                            <i class="fas fa-calendar"></i>
                            Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${formatDate(item.deadline)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderRiskChart(breakdown) {
            const ctx = document.getElementById('riskChart');
            if (riskChart) riskChart.destroy();

            riskChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©', 'Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ©'],
                    datasets: [{
                        data: [
                            (breakdown.global_risk_score * 100).toFixed(0),
                            (breakdown.local_risk_score * 100).toFixed(0),
                            (breakdown.logistic_risk_score * 100).toFixed(0)
                        ],
                        backgroundColor: ['#ef4444', '#f59e0b', '#6366f1'],
                        borderColor: '#0f172a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: { color: '#cbd5e1', padding: 15, font: { family: 'Cairo' } }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            rtl: true,
                            callbacks: { label: ctx => ctx.label + ': ' + ctx.parsed + '%' }
                        }
                    }
                }
            });
        }

        function renderMetrics(metadata, data) {
            const container = document.getElementById('metricsContainer');
            container.innerHTML = `
                <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 0.75rem;">
                    <div style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 0.25rem;">ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø±</div>
                    <div style="font-weight: 600; color: var(--text-primary);">${new Date(metadata.decision_timestamp).toLocaleString('ar-SA')}</div>
                </div>
                <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 0.75rem;">
                    <div style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 0.25rem;">ØµØ§Ù„Ø­ Ø­ØªÙ‰</div>
                    <div style="font-weight: 600; color: var(--text-primary);">${new Date(metadata.valid_until).toLocaleString('ar-SA')}</div>
                </div>
                <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md);">
                    <div style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 0.25rem;">Ø«Ù‚Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="flex: 1; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                            <div style="width: ${metadata.model_confidence * 100}%; height: 100%; background: var(--gradient-success);"></div>
                        </div>
                        <span style="font-weight: 600; color: var(--accent-green);">${(metadata.model_confidence * 100).toFixed(0)}%</span>
                    </div>
                </div>
            `;
        }
    </script>
</body>

</html>